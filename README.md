# Курс основ программирования на МКН СПбГУ
## Проект 2: key-value база данных

[Постановка задачи](./TASK.md)

### Документация

Данная утилита является консольным интерфейсом к базе данных, которая поддерживает операции по поиску, вставке и удалению текстовых значений по соответствующим им текстовым ключам.

#### Входные данные

Данная утилита имеет 2 режима работы с входными данными.

При запуске с параметрами, принимает одну команду, выполняет её или выводит сообщение о невозможности и завершается.

При запуске без параметров, принимает сколько угодно команд по 1 в строке до конца ввода и отвечает на них по мере получения.

#### Интерфейс:

Есть три вида команд:
* *add key value* - добавляет в базу данных значение *value* по ключу *key*, если в базе ещё нет такого ключа, иначе ничего не делает и выводит сообщение пользователю
* *remove key* - если в базе есть ключ *key*, то удаляет его, иначе ничего не делает и выводит сообщение пользователю
* *get key* - если в базе есть ключ *key*, то выводит значение ему соответствующее, иначе ничего не делает и выводит сообщение пользователю

#### Примеры использования:

    $ db add key value
    $ db get key

или

    $ db
    add key value
    get key

#### Принцип работы

База данных представляет из себя бинарное дерево, в листах которого хранятся файлы, соответсвующие существующим парам ключ-значение.
Корневая директория задаётся константой *STARTDIR*.
Для каждого ключа считается 32-битный бинарный хэш, который будет путём до листа, в котором будет хранится соответвующий файл.

Например, если хэш ключа равен *00101001010010101001010110001101*, то файл будет хранится в диретории *STARTDIR/0/0/1/0/1/0/0/1/0/1/0/0/1/0/1/0/1/0/0/1/0/1/0/1/1/0/0/0/1/1/0/1*.

Ввиду коллизий в папке может хранится более одного файла, поэтому при добавлении файла в директорию с помощью MEX выбирается ещё незанятое имя файла,
а при поиске по ключу, когда мы оказались в нужной директории просматриваются все файлы в поиске запрашиваемого ключа.

Для оптимизации количества операций и используемой памяти при добавлении новых пар ключ-значение создаётся не полный путь из 32 уровней, а только его префикс, если с какого-то момента есть только один файл, у которого такой префикс хэша.
Также при удалении пары-ключ значение удаляются все более неиспользуемые директории.
